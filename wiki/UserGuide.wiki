#summary How to manage your virtual enviroment using vmaki



= Introduction =

This page contains the user guide for *vmaki 1.0* and will help you using it effectively in your enviroment. 

= Contents =

<wiki:toc max_depth="1" />


= Getting Started =

Check out the [GettingStarted Getting Started Guide] to get vmaki running in your enviroment.

= Login =

If _vmaki_ is set up as described in the [GettingStarted Getting Started Guide] you can connect to it using your browser (Firefox is highly recommended) entering the URI of the host on which _vmaki_ is installed from any workstation in your network. vmaki is running on *Port 8000*, therefore you have to make sure to specify the port in the URI. Have a look at the example below.

[http://vmaki.googlecode.com/files/url.png]

You will then be promted to enter the username and password. If you log in for the first time you will have to use the predefined admin user account:

  * *username: admin*
  * *password: admin*

After you successfully logged in with the admin user account you should create a new user account and change the admin's password. Have a look at [UserGuide#User_Management User Management] to see how that is done.

= Host Management =

You can add one or several Xen host to _vmaki_. The local Xen host on the system _vmaki_ has been installed can be added right away without any further modifications. In order to connect remote Xen Hosts running on an other system than _vmaki_ itself, you have to set up the Xen host as discribed in the [GettingStarted#Xen_Node Getting Started Guide].

== Adding a Xen Host ==

To add a Xen host to _vmaki_ you simply click on the _Host Menu_ on the top toolbar and choose the item _Add Host_. A pop-up will appear and ask you for some paramenters:

[http://vmaki.googlecode.com/files/add_host_menu.png]

[http://vmaki.googlecode.com/files/add_host.png]



==== Host Name ====

This field expects the name of the host on which the Xen host is installed. You can either enter the IP Adress or the DNS name of the host. It is not recommended to use localhost as the host name for the local Xen host because the hostname will alos be used for the VNC link which is needed to access the console of a VM and could not be used in that case.

==== Connection ==== 
This field sets the protocol which is used to establish the connection to the Xen host. In the current version of _vmaki_ only ssh connections are supported, therefore this entry can not be changed.

==== User ====
This field specifies the user wich is used to connect to the Xen host. 


==== Password ====
Here you have to enter the password of the user specified above.

==== LVM Pool Name ====
It is mandatory to have set up your Xen host using LVM as described in the [GettingStarted Getting Started Guide]. In this field you have to enter the LVM pool name of the Xen host. 
   

= VM Management =

== Creating a VM ==

To create a VM you have to select the host on which you want the VM to be created. If the correct Xen host is selected you can simply click on the _Add VM_ button on the top toolbar.

[http://vmaki.googlecode.com/files/add_vm_button.png]

A pop-up window will appear where you can enter the desired configuration for the VM.

[http://vmaki.googlecode.com/files/add_vm.png]

==== VM Name ====
Enter the name for the VM

==== Type ====
There are two different virtualization modes supported by Xen:

===== para-virtualized (PV) =====
A guest operating system on a para-virtualized VM must be _virtualization aware_ which means that it has to provide an interface to the Xen hypervisor. Therefore the kernel of the guest operating system has to be modified. This virtualization method has compared to other virtualization methods a better performance. The disadvantage is that only operating systems with a modified kernel can be installed. Also the installation process is more complex to other methods.

_vmaki_ supports the fully automated provisioning of a Debian Lenny system. Choose type PV and you get a fully executable Debian Lenny System! PV is your choise if you want a VM with good performance.

After a PV VM has been created the provisioning of Debian Lenny automatically starts and the status of the VM in the tree and on the general tab are set to provisioning. The provisioning can take a couple of minutes, you will that the provisioning is done when the status of the VM has been updatad to shutoff.

[http://vmaki.googlecode.com/files/provisioning.png]    

===== HVM =====

On a HVM based VM the virtualization functionality is implemented in the hardware. The guest operating system has not to be aware that it is virtualized, therefore its kernel does not have to be modified.

To be able to run HVM VMs the CPU of the Xen host must provide HVM support (Intel VT-x/VT-i / AMD Pacifica). Also the HVM support must be activated on the mainboard. You can check on the _General Tab_ in _vmaki_ if HVM is supported for the selected Xen host.

[http://vmaki.googlecode.com/files/hvm_support.png]
 
==== Memory ====
Here you can enter how much of the physical memory of the Xen host is going to be used by the VM.

==== VCPU ====
This field sets the amount of virtual CPUs that are going to be used by the VM

==== Root Parition Capacity ====
Here you can enter the size of the locigal volume for the VM. The size may not be larger than the available capacity left on the LVM pool.


==== NIC ====
In this drop down menu you can choose which network interface of the Xen Host is going to be mapped to the VM. 

==== Media ====
Here you can specify wich media is attached to the VM. You can either choose _CD-ROM_ for the physical drive of the Xen host or _ISO File_ to attach a ISO file which has been uploaded to _vmaki_. Have a look at [UserGuide#ISO_Management ISO Management] to see how an ISO file is uploaded to _vmaki_.

== Installing the Guest Operating System ==


==== PV ====
On PV VMs Debian Lenny gets installed fully automated. The operating system is executable as soon as the provisioning is terminated.

==== HVM ====
To install the guest operating system on HVM VMs you need to provide the installation media. You can either attach the physical CD-ROM drive or an ISO file. If not changed when adding the VM, the CD-ROM drive is attached by default. Have a look at [userGuide#Change_the attached_Media_of_a_VM Change attached Media] to see how you can change the attached media of a VM.

Further you have to configure the boot device of the VM. By default the CD-ROM drive is set as the boot device. Alternative boot devices are HD (logical volume) and Network (PXE). [userGuide#Reconfigure_a_VM] shows you how you can change the boot device of a vm.


== Controlling a VM ==

A VM can be controlled via the top toolbar or the VM context menu, which can be opened by right clicking on the VM. 

[http://vmaki.googlecode.com/files/vm_context.png]


== Reconfigure a VM ==

To reconfigure the VM settings you can either use the _Reconfigure VM_ item in the _Edit Menu_ from the top toolbar or from the context menu of the selected VM. After clicking on the _Reconfigure VM_ item a pop-up window is shown with the current configuration of the VM.

[http://vmaki.googlecode.com/files/reconfigure_vm.png]

==== Memory ====
Here you can change how much of the physical memory of the Xen host is used by the VM. For _HVM_ VMs this can only be changed when the VM is shut down. The memory for _PV_ VMs can be changed at runtime but may not exceed the _Maximumg Memory_ value.

==== Maximum Memory ====
This parameter can only be set for _PV_ VMs and specifies the maximum value the memory of the VM can be extended at runtime. The maximum memory value should never be smaller than the memory value.

==== Root Partition Capacity ====
The size of the root partition can be incread or decreased. Be aware that decreasing the partition may cause data loss. This parameter can only be changed if the VM is shut down.

==== Boot Device ====
Here you can change the boot device of the VM. Since a _PV_ VMs does not specify a boot device this can only be changed for _HVM_ VMs.

==== NIC ====
In this drop down menu you can change whick network interface from the Xen host is used by the VM.

== Change the attached Media of a VM ==

== Connect VNC Console of a Guest System ==

To connect the VNC console of a guest system you simply need to click on the VNC link which can be found in the console tab. After clicking on the vnc link you will be promted to choose which VNC viewer will be used to connect the console.

[http://vmaki.googlecode.com/files/vnc_link.png]

[http://vmaki.googlecode.com/files/vnc_console_debian_small.png]

There has to be a VNC viewer installed on your system in order to use the VNC link. Here are some links to download a VNC viewer which can be used for vmaki. ThightVNC also provides a Java version of its viewer which doesn't have to be installed, in case you don't have permission on the system to do so.

[http://www.tightvnc.com/download.html ThightVNC (Linux / Windows)]

[http://www.realvnc.com/products/download.html RealVNC (Linux / Windows)]

=== Registering VNC Protocol on Windows ===

If you are using a Windows operating system you need to register the VNC protocol in order to be able to choose your VNC viewer when clicking on the vnc link in vmaki. This can be done by adding an entry to the Windows registery. To simplify this we recommend to use the customURL tool which can be downloaded here:

[http://customurl.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=15090#ReleaseFiles customURL]

= ISO Management =

You can upload ISO files to _vmaki_ which can be attached to the VMs. Click on the _ISO Tab_ to get to the overview of all ISO files that are currently available. You can then add a new ISO file, delete or rename an existing one. 

[http://vmaki.googlecode.com/files/iso_toolbar.png]


= Snapshot Management =

To backup a VM you can take a snapshot of it which stores the current state of the VM and writes it to an image file. Click on the _Snapshot Tab_ to get to overview of the current snapshots of a VM.

[http://vmaki.googlecode.com/files/toolbar_snapshot.png]

== Taking a Snapshot ==

To take a snapshot of a VM you simply select the VM you want to backup and click on the _Add Snapshot_ button. This can be done while the VM is running. After clicking on the _Add Snapshot_ button you will be promted to enter a description of the snapshot. 

[http://vmaki.googlecode.com/files/add_snapshot.png]

As soon as you commit, the snapshot is being taken and writen into the file. This can take a couple of minutes depending on the size of the logical volume of the VM. You can check the status of the snapshot in the panel of the _Snapshot Tab_.

[http://vmaki.googlecode.com/files/creating_snapshot.png]

[http://vmaki.googlecode.com/files/ready_snapshot.png]  

== Restoring a Snapshot ==

To restore a snapshot you have to select the snapshot which has to be restored. Simply click on the _Restore Snapshot_ button in the toolbar. Make sure the VM is not runnig. The status of the snapshot and the VM is changed to restoring. After the restore is done the status will change back to ready.


[http://vmaki.googlecode.com/files/restoring_snapshot.png] 

[http://vmaki.googlecode.com/files/restoring_snapshot_node.png] 

= User Management =

vmaki has a build in user management which allows you to controll the access for vmaki. The user management can be accessed via the User tab. It allows you to create a new user or delete or rename an existing one. Also the password of an existing user can be reseted.

[http://vmaki.googlecode.com/files/user_tab.png]

== Creating a new User ==

A new user can be added via the Add User button. In the appearing pop-up menu the username, the userrole and the password have to be specified. The role of the new user can either be *Administrator* or *User*. If you define the new us as an Administrator he can also administer the user management while the role user doesn't allow this. Despite of that there are no differences the role Administrator and User.

[http://vmaki.googlecode.com/files/add_user_window.png]  